<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="API docs for the handleMessage method from the ChannelBuffers class, for the Dart programming language.">
  <title>handleMessage method - ChannelBuffers class - dart:ui library - Dart API</title>

  <!-- required because all the links are pseudo-absolute -->
  <base href="../../">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="static-assets/github.css?v1">
  <link rel="stylesheet" href="static-assets/styles.css?v1">
  <link rel="icon" href="static-assets/favicon.png?v1">

  <!-- style overrides for dartdoc -->
<style>
@import 'https://fonts.googleapis.com/css?family=Roboto:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Google+Sans:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Open+Sans:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Sharp|Material+Icons+Round';
</style>

<link href="https://flutter.github.io/assets-for-api-docs/assets/cupertino/cupertino.css" rel="stylesheet" type="text/css">

<link href="../assets/overrides.css" rel="stylesheet" type="text/css">

<link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Sharp|Material+Icons+Round" rel="stylesheet">
<style>
  /* Rule for sizing the icon. */
  .md-36 { font-size: 36px; }
</style>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f)
})(window,document,'script','dataLayer','GTM-ND4LWWZ');</script>
<!-- End Google Tag Manager -->

<script async="" defer="" src="../assets/api_survey.js"></script>

<!-- Styles and scripting for handling custom code snippets -->
<link href="../assets/snippets.css" rel="stylesheet" type="text/css">
<script src="../assets/snippets.js"></script>

<link rel="search" type="application/opensearchdescription+xml" title="Flutter API" href="/opensearch.xml"/>

</head>


<body data-base-href="../../" data-using-base-href="true" class="light-theme">

<div id="overlay-under-drawer"></div>

<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="index.html">Flutter</a></li>
    <li><a href="dart-ui/dart-ui-library.html">dart:ui</a></li>
    <li><a href="dart-ui/ChannelBuffers-class.html">ChannelBuffers</a></li>
    <li class="self-crumb">handleMessage method</li>
  </ol>
  <div class="self-name">handleMessage</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <div class="toggle" id="theme-button">
    <label for="theme">
      <input type="checkbox" id="theme" value="light-theme">
      <span id="dark-theme-button" class="material-symbols-outlined">
        brightness_4
      </span>
      <span id="light-theme-button" class="material-symbols-outlined">
        brightness_5
      </span>
    </label>
  </div>
</header>
<main>

  <div
      id="dartdoc-main-content"
      class="main-content"
      data-above-sidebar="dart-ui&#47;ChannelBuffers-class-sidebar.html"
      data-below-sidebar="">
      <div>
<h1><span class="kind-method">handleMessage</span> method 
</h1></div>

    <section class="multi-line-signature">
      

<span class="returntype">void</span>
<span class="name ">handleMessage</span>(<wbr><ol class="parameter-list"><li><span class="parameter" id="handleMessage-param-data"><span class="type-annotation"><a href="dart-typed_data/ByteData-class.html">ByteData</a></span> <span class="parameter-name">data</span></span></li>
</ol>)

      

    </section>
    
<section class="desc markdown">
  <p>Handle a control message.</p>
<p>This is intended to be called by the platform messages dispatcher, forwarding
messages from plugins to the <a href="dart-ui/ChannelBuffers/kControlChannelName-constant.html">kControlChannelName</a> channel.</p>
<p>Messages use the <a href="services/StandardMethodCodec-class.html">StandardMethodCodec</a> format. There are two methods
supported: <code>resize</code> and <code>overflow</code>. The <code>resize</code> method changes the size
of the buffer, and the <code>overflow</code> method controls whether overflow is
expected or not.</p>
<h2 id="resize"><code>resize</code></h2>
<p>The <code>resize</code> method takes as its argument a list with two values, first
the channel name (a UTF-8 string less than 254 bytes long and not
containing any null bytes), and second the allowed size of the channel
buffer (an integer between 0 and 2147483647).</p>
<p>Upon receiving the message, the channel's buffer is resized. If necessary,
messages are silently discarded to ensure the buffer is no bigger than
specified.</p>
<p>For historical reasons, this message can also be sent using a bespoke
format consisting of a UTF-8-encoded string with three parts separated
from each other by U+000D CARRIAGE RETURN (CR) characters, the three parts
being the string <code>resize</code>, the string giving the channel name, and then
the string giving the decimal serialization of the new channel buffer
size. For example: <code>resize\rchannel\r1</code></p>
<h2 id="overflow"><code>overflow</code></h2>
<p>The <code>overflow</code> method takes as its argument a list with two values, first
the channel name (a UTF-8 string less than 254 bytes long and not
containing any null bytes), and second a boolean which is true if overflow
is expected and false if it is not.</p>
<p>This sets a flag on the channel in debug mode. In release mode the message
is silently ignored. The flag indicates whether overflow is expected on this
channel. When the flag is set, messages are discarded silently. When the
flag is cleared (the default), any overflow on the channel causes a message
to be printed to the console, warning that a message was lost.</p>
</section>


    
<section class="summary source-code" id="source">
  <h2><span>Implementation</span></h2>
  <pre class="language-dart"><code class="language-dart">void handleMessage(ByteData data) {
  &#47;&#47; We hard-code the deserialization here because the StandardMethodCodec class
  &#47;&#47; is part of the framework, not dart:ui.
  final Uint8List bytes = data.buffer.asUint8List(data.offsetInBytes, data.lengthInBytes);
  if (bytes[0] == 0x07) { &#47;&#47; 7 = value code for string
    final int methodNameLength = bytes[1];
    if (methodNameLength &gt;= 254) { &#47;&#47; lengths greater than 253 have more elaborate encoding
      throw Exception(&#39;Unrecognized message sent to $kControlChannelName (method name too long)&#39;);
    }
    int index = 2; &#47;&#47; where we are in reading the bytes
    final String methodName = utf8.decode(bytes.sublist(index, index + methodNameLength));
    index += methodNameLength;
    switch (methodName) {
      case &#39;resize&#39;:
        if (bytes[index] != 0x0C) { &#47;&#47; 12 = value code for list
          throw Exception(&quot;Invalid arguments for &#39;resize&#39; method sent to $kControlChannelName (arguments must be a two-element list, channel name and new capacity)&quot;);
        }
        index += 1;
        if (bytes[index] &lt; 0x02) { &#47;&#47; We ignore extra arguments, in case we need to support them in the future, hence &lt;2 rather than !=2.
          throw Exception(&quot;Invalid arguments for &#39;resize&#39; method sent to $kControlChannelName (arguments must be a two-element list, channel name and new capacity)&quot;);
        }
        index += 1;
        if (bytes[index] != 0x07) { &#47;&#47; 7 = value code for string
          throw Exception(&quot;Invalid arguments for &#39;resize&#39; method sent to $kControlChannelName (first argument must be a string)&quot;);
        }
        index += 1;
        final int channelNameLength = bytes[index];
        if (channelNameLength &gt;= 254) { &#47;&#47; lengths greater than 253 have more elaborate encoding
          throw Exception(&quot;Invalid arguments for &#39;resize&#39; method sent to $kControlChannelName (channel name must be less than 254 characters long)&quot;);
        }
        index += 1;
        final String channelName = utf8.decode(bytes.sublist(index, index + channelNameLength));
        if (channelName.contains(&#39;\u0000&#39;)) {
          throw Exception(&quot;Invalid arguments for &#39;resize&#39; method sent to $kControlChannelName (channel name must not contain any null bytes)&quot;);
        }
        index += channelNameLength;
        if (bytes[index] != 0x03) { &#47;&#47; 3 = value code for uint32
          throw Exception(&quot;Invalid arguments for &#39;resize&#39; method sent to $kControlChannelName (second argument must be an integer in the range 0 to 2147483647)&quot;);
        }
        index += 1;
        resize(channelName, data.getUint32(index, Endian.host));
      case &#39;overflow&#39;:
        if (bytes[index] != 0x0C) { &#47;&#47; 12 = value code for list
          throw Exception(&quot;Invalid arguments for &#39;overflow&#39; method sent to $kControlChannelName (arguments must be a two-element list, channel name and flag state)&quot;);
        }
        index += 1;
        if (bytes[index] &lt; 0x02) { &#47;&#47; We ignore extra arguments, in case we need to support them in the future, hence &lt;2 rather than !=2.
          throw Exception(&quot;Invalid arguments for &#39;overflow&#39; method sent to $kControlChannelName (arguments must be a two-element list, channel name and flag state)&quot;);
        }
        index += 1;
        if (bytes[index] != 0x07) { &#47;&#47; 7 = value code for string
          throw Exception(&quot;Invalid arguments for &#39;overflow&#39; method sent to $kControlChannelName (first argument must be a string)&quot;);
        }
        index += 1;
        final int channelNameLength = bytes[index];
        if (channelNameLength &gt;= 254) { &#47;&#47; lengths greater than 253 have more elaborate encoding
          throw Exception(&quot;Invalid arguments for &#39;overflow&#39; method sent to $kControlChannelName (channel name must be less than 254 characters long)&quot;);
        }
        index += 1;
        final String channelName = utf8.decode(bytes.sublist(index, index + channelNameLength));
        index += channelNameLength;
        if (bytes[index] != 0x01 &amp;&amp; bytes[index] != 0x02) { &#47;&#47; 1 = value code for true, 2 = value code for false
          throw Exception(&quot;Invalid arguments for &#39;overflow&#39; method sent to $kControlChannelName (second argument must be a boolean)&quot;);
        }
        allowOverflow(channelName, bytes[index] == 0x01);
      default:
        throw Exception(&quot;Unrecognized method &#39;$methodName&#39; sent to $kControlChannelName&quot;);
    }
  } else {
    final List&lt;String&gt; parts = utf8.decode(bytes).split(&#39;\r&#39;);
    if (parts.length == 1 + &#47;*arity=*&#47;2 &amp;&amp; parts[0] == &#39;resize&#39;) {
      resize(parts[1], int.parse(parts[2]));
    } else {
      &#47;&#47; If the message couldn&#39;t be decoded as UTF-8, a FormatException will
      &#47;&#47; have been thrown by utf8.decode() above.
      throw Exception(&#39;Unrecognized message $parts sent to $kControlChannelName.&#39;);
    }
  }
}</code></pre>
</section>


  </div> <!-- /.main-content -->

  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>

<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="index.html">Flutter</a></li>
    <li><a href="dart-ui/dart-ui-library.html">dart:ui</a></li>
    <li><a href="dart-ui/ChannelBuffers-class.html">ChannelBuffers</a></li>
    <li class="self-crumb">handleMessage method</li>
</ol>


    <h5>ChannelBuffers class</h5>
  </div><!--/.sidebar-offcanvas-->

  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  </div><!--/.sidebar-offcanvas-->

</main>

<footer>
  <span class="no-break">
    Flutter
      0.0.0
  </span>

  <script src="footer.js"></script>
</footer>



<script src="static-assets/highlight.pack.js?v1"></script>
<script src="static-assets/docs.dart.js"></script>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-ND4LWWZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


</body>

</html>

