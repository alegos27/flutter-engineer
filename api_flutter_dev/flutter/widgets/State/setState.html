<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, user-scalable=no">
  <meta name="description" content="API docs for the setState method from the State class, for the Dart programming language.">
  <title>setState method - State class - widgets library - Dart API</title>

  <!-- required because all the links are pseudo-absolute -->
  <base href="../../">

  
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;0,400;0,500;0,700;1,400&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,400,0,0" rel="stylesheet">
  
  <link rel="stylesheet" href="static-assets/github.css?v1">
  <link rel="stylesheet" href="static-assets/styles.css?v1">
  <link rel="icon" href="static-assets/favicon.png?v1">

  <!-- style overrides for dartdoc -->
<style>
@import 'https://fonts.googleapis.com/css?family=Roboto:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Google+Sans:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Open+Sans:500,400italic,300,400,100i';
@import 'https://fonts.googleapis.com/css?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Sharp|Material+Icons+Round';
</style>

<link href="https://flutter.github.io/assets-for-api-docs/assets/cupertino/cupertino.css" rel="stylesheet" type="text/css">

<link href="../assets/overrides.css" rel="stylesheet" type="text/css">

<link href="https://fonts.googleapis.com/icon?family=Material+Icons|Material+Icons+Outlined|Material+Icons+Sharp|Material+Icons+Round" rel="stylesheet">
<style>
  /* Rule for sizing the icon. */
  .md-36 { font-size: 36px; }
</style>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f)
})(window,document,'script','dataLayer','GTM-ND4LWWZ');</script>
<!-- End Google Tag Manager -->

<script async="" defer="" src="../assets/api_survey.js"></script>

<!-- Styles and scripting for handling custom code snippets -->
<link href="../assets/snippets.css" rel="stylesheet" type="text/css">
<script src="../assets/snippets.js"></script>

<link rel="search" type="application/opensearchdescription+xml" title="Flutter API" href="/opensearch.xml"/>

</head>


<body data-base-href="../../" data-using-base-href="true" class="light-theme">

<div id="overlay-under-drawer"></div>

<header id="title">
  <span id="sidenav-left-toggle" class="material-symbols-outlined" role="button" tabindex="0">menu</span>
  <ol class="breadcrumbs gt-separated dark hidden-xs">
    <li><a href="index.html">Flutter</a></li>
    <li><a href="widgets/widgets-library.html">widgets</a></li>
    <li><a href="widgets/State-class.html">State<span class="signature">&lt;<wbr><span class="type-parameter">T extends StatefulWidget</span>&gt;</span></a></li>
    <li class="self-crumb">setState method</li>
  </ol>
  <div class="self-name">setState</div>
  <form class="search navbar-right" role="search">
    <input type="text" id="search-box" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
  <div class="toggle" id="theme-button">
    <label for="theme">
      <input type="checkbox" id="theme" value="light-theme">
      <span id="dark-theme-button" class="material-symbols-outlined">
        brightness_4
      </span>
      <span id="light-theme-button" class="material-symbols-outlined">
        brightness_5
      </span>
    </label>
  </div>
</header>
<main>

  <div
      id="dartdoc-main-content"
      class="main-content"
      data-above-sidebar="widgets&#47;State-class-sidebar.html"
      data-below-sidebar="">
      <div>
  <div id="external-links" class="btn-group"><a title="View source code" class="source-link" href="https://github.com/flutter/flutter/blob/master/packages/flutter/lib/src/widgets/framework.dart#L1164"><span class="material-symbols-outlined">description</span></a></div>
<h1><span class="kind-method">setState</span> method 
</h1></div>

    <section class="multi-line-signature">
      
  <div>
    <ol class="annotation-list">
        <li>@<a href="meta/protected-constant.html">protected</a></li>
    </ol>
  </div>

<span class="returntype">void</span>
<span class="name ">setState</span>(<wbr><ol class="parameter-list"><li><span class="parameter" id="setState-param-fn"><span class="type-annotation"><a href="dart-ui/VoidCallback.html">VoidCallback</a></span> <span class="parameter-name">fn</span></span></li>
</ol>)

      

    </section>
    
<section class="desc markdown">
  <p>Notify the framework that the internal state of this object has changed.</p>
<p>Whenever you change the internal state of a <a href="widgets/State-class.html">State</a> object, make the
change in a function that you pass to <a href="widgets/State/setState.html">setState</a>:</p>
<pre class="language-dart"><code class="language-dart">setState(() { _myState = newValue; });
</code></pre>
<p>The provided callback is immediately called synchronously. It must not
return a future (the callback cannot be <code>async</code>), since then it would be
unclear when the state was actually being set.</p>
<p>Calling <a href="widgets/State/setState.html">setState</a> notifies the framework that the internal state of this
object has changed in a way that might impact the user interface in this
subtree, which causes the framework to schedule a <a href="widgets/State/build.html">build</a> for this <a href="widgets/State-class.html">State</a>
object.</p>
<p>If you just change the state directly without calling <a href="widgets/State/setState.html">setState</a>, the
framework might not schedule a <a href="widgets/State/build.html">build</a> and the user interface for this
subtree might not be updated to reflect the new state.</p>
<p>Generally it is recommended that the <a href="widgets/State/setState.html">setState</a> method only be used to
wrap the actual changes to the state, not any computation that might be
associated with the change. For example, here a value used by the <a href="widgets/State/build.html">build</a>
function is incremented, and then the change is written to disk, but only
the increment is wrapped in the <a href="widgets/State/setState.html">setState</a>:</p>
<pre class="language-dart"><code class="language-dart">Future&lt;void&gt; _incrementCounter() async {
  setState(() {
    _counter++;
  });
  Directory directory = await getApplicationDocumentsDirectory(); // from path_provider package
  final String dirName = directory.path;
  await File('$dirName/counter.txt').writeAsString('$_counter');
}
</code></pre>
<p>Sometimes, the changed state is in some other object not owned by the
widget <a href="widgets/State-class.html">State</a>, but the widget nonetheless needs to be updated to react to
the new state. This is especially common with <a href="foundation/Listenable-class.html">Listenable</a>s, such as
<a href="animation/AnimationController-class.html">AnimationController</a>s.</p>
<p>In such cases, it is good practice to leave a comment in the callback
passed to <a href="widgets/State/setState.html">setState</a> that explains what state changed:</p>
<pre class="language-dart"><code class="language-dart">void _update() {
  setState(() { /* The animation changed. */ });
}
//...
animation.addListener(_update);
</code></pre>
<p>It is an error to call this method after the framework calls <a href="widgets/State/dispose.html">dispose</a>.
You can determine whether it is legal to call this method by checking
whether the <a href="widgets/State/mounted.html">mounted</a> property is true. That said, it is better practice
to cancel whatever work might trigger the <a href="widgets/State/setState.html">setState</a> rather than merely
checking for <a href="widgets/State/mounted.html">mounted</a> before calling <a href="widgets/State/setState.html">setState</a>, as otherwise CPU cycles
will be wasted.</p>
<h2 id="design-discussion">Design discussion</h2>
<p>The original version of this API was a method called <code>markNeedsBuild</code>, for
consistency with <a href="rendering/RenderObject/markNeedsLayout.html">RenderObject.markNeedsLayout</a>,
<a href="rendering/RenderObject/markNeedsPaint.html">RenderObject.markNeedsPaint</a>, <em>et al</em>.</p>
<p>However, early user testing of the Flutter framework revealed that people
would call <code>markNeedsBuild()</code> much more often than necessary. Essentially,
people used it like a good luck charm, any time they weren't sure if they
needed to call it, they would call it, just in case.</p>
<p>Naturally, this led to performance issues in applications.</p>
<p>When the API was changed to take a callback instead, this practice was
greatly reduced. One hypothesis is that prompting developers to actually
update their state in a callback caused developers to think more carefully
about what exactly was being updated, and thus improved their understanding
of the appropriate times to call the method.</p>
<p>In practice, the <a href="widgets/State/setState.html">setState</a> method's implementation is trivial: it calls
the provided callback synchronously, then calls <a href="widgets/Element/markNeedsBuild.html">Element.markNeedsBuild</a>.</p>
<h2 id="performance-considerations">Performance considerations</h2>
<p>There is minimal <em>direct</em> overhead to calling this function, and as it is
expected to be called at most once per frame, the overhead is irrelevant
anyway. Nonetheless, it is best to avoid calling this function redundantly
(e.g. in a tight loop), as it does involve creating a closure and calling
it. The method is idempotent, there is no benefit to calling it more than
once per <a href="widgets/State-class.html">State</a> per frame.</p>
<p>The <em>indirect</em> cost of causing this function, however, is high: it causes
the widget to rebuild, possibly triggering rebuilds for the entire subtree
rooted at this widget, and further triggering a relayout and repaint of
the entire corresponding <a href="rendering/RenderObject-class.html">RenderObject</a> subtree.</p>
<p>For this reason, this method should only be called when the <a href="widgets/State/build.html">build</a> method
will, as a result of whatever state change was detected, change its result
meaningfully.</p>
<p>See also:</p>
<ul>
<li><a href="widgets/StatefulWidget-class.html">StatefulWidget</a>, the API documentation for which has a section on
performance considerations that are relevant here.</li>
</ul>
</section>


    
<section class="summary source-code" id="source">
  <h2><span>Implementation</span></h2>
  <pre class="language-dart"><code class="language-dart">@protected
void setState(VoidCallback fn) {
  assert(() {
    if (_debugLifecycleState == _StateLifecycle.defunct) {
      throw FlutterError.fromParts(&lt;DiagnosticsNode&gt;[
        ErrorSummary(&#39;setState() called after dispose(): $this&#39;),
        ErrorDescription(
          &#39;This error happens if you call setState() on a State object for a widget that &#39;
          &#39;no longer appears in the widget tree (e.g., whose parent widget no longer &#39;
          &#39;includes the widget in its build). This error can occur when code calls &#39;
          &#39;setState() from a timer or an animation callback.&#39;,
        ),
        ErrorHint(
          &#39;The preferred solution is &#39;
          &#39;to cancel the timer or stop listening to the animation in the dispose() &#39;
          &#39;callback. Another solution is to check the &quot;mounted&quot; property of this &#39;
          &#39;object before calling setState() to ensure the object is still in the &#39;
          &#39;tree.&#39;,
        ),
        ErrorHint(
          &#39;This error might indicate a memory leak if setState() is being called &#39;
          &#39;because another object is retaining a reference to this State object &#39;
          &#39;after it has been removed from the tree. To avoid memory leaks, &#39;
          &#39;consider breaking the reference to this object during dispose().&#39;,
        ),
      ]);
    }
    if (_debugLifecycleState == _StateLifecycle.created &amp;&amp; !mounted) {
      throw FlutterError.fromParts(&lt;DiagnosticsNode&gt;[
        ErrorSummary(&#39;setState() called in constructor: $this&#39;),
        ErrorHint(
          &#39;This happens when you call setState() on a State object for a widget that &#39;
          &quot;hasn&#39;t been inserted into the widget tree yet. It is not necessary to call &quot;
          &#39;setState() in the constructor, since the state is already assumed to be dirty &#39;
          &#39;when it is initially created.&#39;,
        ),
      ]);
    }
    return true;
  }());
  final Object? result = fn() as dynamic;
  assert(() {
    if (result is Future) {
      throw FlutterError.fromParts(&lt;DiagnosticsNode&gt;[
        ErrorSummary(&#39;setState() callback argument returned a Future.&#39;),
        ErrorDescription(
          &#39;The setState() method on $this was called with a closure or method that &#39;
          &#39;returned a Future. Maybe it is marked as &quot;async&quot;.&#39;,
        ),
        ErrorHint(
          &#39;Instead of performing asynchronous work inside a call to setState(), first &#39;
          &#39;execute the work (without updating the widget state), and then synchronously &#39;
          &#39;update the state inside a call to setState().&#39;,
        ),
      ]);
    }
    &#47;&#47; We ignore other types of return values so that you can do things like:
    &#47;&#47;   setState(() =&gt; x = 3);
    return true;
  }());
  _element!.markNeedsBuild();
}</code></pre>
</section>


  </div> <!-- /.main-content -->

  <div id="dartdoc-sidebar-left" class="sidebar sidebar-offcanvas-left">
    <!-- The search input and breadcrumbs below are only responsively visible at low resolutions. -->
<header id="header-search-sidebar" class="hidden-l">
  <form class="search-sidebar" role="search">
    <input type="text" id="search-sidebar" autocomplete="off" disabled class="form-control typeahead" placeholder="Loading search...">
  </form>
</header>

<ol class="breadcrumbs gt-separated dark hidden-l" id="sidebar-nav">
    <li><a href="index.html">Flutter</a></li>
    <li><a href="widgets/widgets-library.html">widgets</a></li>
    <li><a href="widgets/State-class.html">State<span class="signature">&lt;<wbr><span class="type-parameter">T extends StatefulWidget</span>&gt;</span></a></li>
    <li class="self-crumb">setState method</li>
</ol>


    <h5>State class</h5>
  </div><!--/.sidebar-offcanvas-->

  <div id="dartdoc-sidebar-right" class="sidebar sidebar-offcanvas-right">
  </div><!--/.sidebar-offcanvas-->

</main>

<footer>
  <span class="no-break">
    Flutter
      0.0.0
  </span>

  <script src="footer.js"></script>
</footer>



<script src="static-assets/highlight.pack.js?v1"></script>
<script src="static-assets/docs.dart.js"></script>

<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-ND4LWWZ"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


</body>

</html>

